#!/usr/bin/env ruby

# Reset if needed

`bin/test_reset`

# Clone ruby/spec and MSpec

`git clone https://github.com/ruby/mspec.git mspec`
`git clone https://github.com/ruby/spec.git ruby-spec`

# Override MSpec to skip known failing tests

File.open("ruby-spec/spec_helper.rb", "a") do |f|
  f.write "\n"
  f.write File.read('config/mspec_override.rb')
  f.write "\n"
end

`cp config/skipped_tests.yml ruby-spec/skipped_tests.yml`

# Wrap Array initialization with Grizzly::Group

`bin/convert ruby-spec/core/array true`
`bin/convert ruby-spec/core/enumerable true`
`find ruby-spec/core/array -type f -name "*.rb" -exec sed -i.bak "s/ArraySpecs::MyArray/MyGroupArray/g" {} \\;`